<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wingman Command Center - Trading HQ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e0e6f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .dashboard-header {
            background: rgba(26, 31, 58, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 40px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            position: sticky; top: 0; z-index: 100;
        }
        .header-content {
            max-width: 1400px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
        }
        h1 { font-size: 2em; background: linear-gradient(45deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .status-badge { display: flex; align-items: center; gap: 10px; font-size: 0.9em; color: #10b981; }
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%;
            background: #10b981; box-shadow: 0 0 6px rgba(16, 185, 129, 0.8); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .grid.full-width { grid-template-columns: 1fr; }
        .grid.two-column { grid-template-columns: repeat(2, 1fr); }
        .grid.three-column { grid-template-columns: repeat(3, 1fr); }
        .card {
            background: rgba(26, 31, 58, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px; padding: 24px; backdrop-filter: blur(10px);
            transition: all 0.3s ease; position: relative; overflow: hidden;
        }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.4), transparent); }
        .card:hover { border-color: rgba(99, 102, 241, 0.4); box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15); transform: translateY(-2px); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2); }
        .card-title { font-size: 1.1em; font-weight: 600; color: #e0e6f0; }
        .card-value { font-size: 2em; font-weight: 700; background: linear-gradient(45deg, #6366f1, #8b5cf6); -webkit-background-clip: text;
            background-clip: text; -webkit-text-fill-color: transparent; }
        .card-detail { font-size: 0.9em; color: #9ca3af; margin-top: 8px; }
        .metric-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(99, 102, 241, 0.1); align-items: center; }
        .metric-row:last-child { border-bottom: none; }
        .metric-label { color: #9ca3af; font-size: 0.95em; }
        .metric-value { font-weight: 600; color: #e0e6f0; }
        .metric-value.positive { color: #10b981; }
        .metric-value.negative { color: #ef4444; }

        /* Portfolio Overview */
        .portfolio-card {
            display: flex;
            flex-direction: column;
            gap: 18px;
            padding: 24px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            background: radial-gradient(circle at top, rgba(59, 130, 246, 0.12), rgba(76, 29, 149, 0.18) 45%, rgba(10, 12, 38, 0.95) 100%);
            box-shadow: 0 20px 35px rgba(17, 24, 39, 0.45), inset 0 0 0 1px rgba(255, 255, 255, 0.02);
            border-radius: 16px;
        }
        .portfolio-card .card-header {
            border: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .portfolio-card .card-title {
            font-size: 1.4em;
            font-weight: 700;
            background: linear-gradient(120deg, #c084fc, #60a5fa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.06em;
        }
        .portfolio-subtitle {
            font-size: 0.85em;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #a5b4fc;
        }
        .portfolio-highlight {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 14px 18px;
            background: linear-gradient(115deg, rgba(56, 189, 248, 0.18), rgba(129, 140, 248, 0.22), rgba(244, 114, 182, 0.16));
            border: 1px solid rgba(129, 140, 248, 0.4);
            border-radius: 12px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.04);
        }
        .portfolio-band {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            color: #e0e7ff;
            font-size: 0.95em;
            font-weight: 600;
        }
        .portfolio-band-title {
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #fdf4ff;
        }
        .portfolio-band-meta {
            font-size: 0.85em;
            color: #c7d2fe;
        }
        .portfolio-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .portfolio-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 0.78em;
            font-weight: 600;
            color: #e5edff;
            background: rgba(79, 70, 229, 0.28);
            border: 1px solid rgba(165, 180, 252, 0.35);
            border-radius: 999px;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.25);
        }
        .portfolio-thesis { background: rgba(99, 102, 241, 0.12); border: 1px solid rgba(99, 102, 241, 0.25); border-radius: 10px; padding: 16px 18px; box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.015); }
        .portfolio-thesis .portfolio-section-title { margin-bottom: 8px; }
        .portfolio-thesis p { margin-bottom: 10px; color: #cbd5f5; font-size: 0.92em; line-height: 1.55; }
        .portfolio-thesis ul { margin: 0 0 0 16px; line-height: 1.55; color: #d1d5db; font-size: 0.88em; }
        .portfolio-thesis li { margin-bottom: 6px; }
        .portfolio-thesis li:last-child { margin-bottom: 0; }
        .portfolio-summary { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(190px, 1fr)); }
        .portfolio-summary-item { background: rgba(15, 20, 46, 0.8); border-radius: 12px; padding: 14px 16px; border: 1px solid rgba(99, 102, 241, 0.28); box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02); display: flex; flex-direction: column; gap: 4px; }
        .portfolio-summary-label { font-size: 0.75em; letter-spacing: 0.08em; text-transform: uppercase; color: #94a3b8; }
        .portfolio-summary-value { font-size: 1.6em; font-weight: 700; background: linear-gradient(45deg, #818cf8, #a855f7); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .portfolio-summary-note { font-size: 0.75em; color: #8b9bbd; letter-spacing: 0.06em; text-transform: uppercase; }
        .portfolio-cash-callout { background: linear-gradient(90deg, rgba(16, 185, 129, 0.25), rgba(2, 132, 199, 0.25)); border: 1px solid rgba(16, 185, 129, 0.35); border-radius: 10px; padding: 14px 16px; font-size: 0.85em; color: #ccfbf1; }
        .portfolio-cash-callout strong { display: block; font-size: 0.9em; color: #5eead4; margin-bottom: 4px; letter-spacing: 0.08em; text-transform: uppercase; }
        .portfolio-breakdown { display: grid; gap: 20px; }
        @media (min-width: 992px) { .portfolio-breakdown { grid-template-columns: repeat(2, 1fr); } }
        .portfolio-section-title { font-size: 0.85em; font-weight: 600; color: #9fb4ff; letter-spacing: 0.07em; text-transform: uppercase; }
        .portfolio-table { width: 100%; border-collapse: collapse; margin-top: 10px; background: rgba(10, 14, 39, 0.6); border: 1px solid rgba(99, 102, 241, 0.18); border-radius: 10px; overflow: hidden; }
        .portfolio-table th,
        .portfolio-table td { padding: 8px 12px; border-bottom: 1px solid rgba(99, 102, 241, 0.12); font-size: 0.85em; }
        .portfolio-table th { color: #8fa0c9; font-size: 0.72em; letter-spacing: 0.07em; text-transform: uppercase; }
        .portfolio-table tbody tr:nth-child(even) { background: rgba(99, 102, 241, 0.06); }
        .portfolio-table tbody tr:hover { background: rgba(99, 102, 241, 0.12); }
        .portfolio-table td:first-child { font-weight: 500; color: #e6e9ff; }
        .portfolio-table td.value { text-align: right; font-weight: 600; color: #f1f5ff; }
        .portfolio-table tr:last-child td { border-bottom: none; }
        .portfolio-total-row td { border-top: 1px solid rgba(99, 102, 241, 0.3); font-weight: 700; }
        @media (max-width: 768px) {
            .portfolio-card { padding: 18px; }
            .portfolio-summary { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
            .portfolio-table { font-size: 0.82em; }
            .portfolio-table th, .portfolio-table td { padding: 8px 10px; }
            .portfolio-band { flex-direction: column; align-items: flex-start; gap: 6px; }
            .portfolio-band-meta { font-size: 0.8em; }
            .portfolio-chip { font-size: 0.76em; }
        }

        /* Daily Loss Limit Tracker */
        .limit-tracker { margin-top: 16px; }
        .limit-label { font-size: 0.85em; font-weight: 600; color: #9ca3af; margin-bottom: 8px; }
        .limit-bar-container { background: rgba(99,102,241,0.15); border-radius: 8px; height: 16px; overflow: hidden; border: 1px solid rgba(99,102,241,0.3); }
        .limit-bar { height: 100%; background: linear-gradient(90deg, #10b981, #84cc16); transition: width 0.5s ease; }
        .limit-bar.warning { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .limit-bar.danger { background: linear-gradient(90deg, #ef4444, #f87171); }
        .limit-text { display: flex; justify-content: space-between; font-size: 0.8em; margin-top: 6px; color: #9ca3af; }
        .limit-status { font-weight: 600; color: #10b981; }
        .limit-status.warning { color: #f59e0b; }
        .limit-status.danger { color: #ef4444; }

        /* Trade Item Styling */
        .trade-item { background: rgba(99, 102, 241, 0.08); border-left: 3px solid #6366f1; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9em; }
        .trade-item.loss { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.08); }
        .trade-item.win { border-left-color: #10b981; background: rgba(16, 185, 129, 0.08); }
        .trade-item.violation { border-left-color: #f59e0b; background: rgba(245, 158, 11, 0.08); }
        .trade-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .trade-symbol { font-weight: 700; color: #e0e6f0; }
        .trade-pnl { font-weight: 700; color: #10b981; }
        .trade-pnl.loss { color: #ef4444; }
        .trade-meta { display: flex; justify-content: space-between; font-size: 0.8em; color: #9ca3af; }

        /* Checklist Styling */
        .checklist-item { display: flex; gap: 8px; margin-bottom: 10px; }
        .checkbox { width: 20px; height: 20px; border: 2px solid rgba(99, 102, 241, 0.5); border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
        .checkbox:hover { border-color: rgba(99, 102, 241, 1); }
        .checkbox.checked { background: #6366f1; border-color: #6366f1; color: white; }
        .checklist-label { font-size: 0.95em; color: #e0e6f0; flex: 1; }
        .checklist-status { margin-top: 12px; padding: 12px; border-radius: 8px; text-align: center; font-weight: 600; }
        .checklist-status.ready { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
        .checklist-status.notready { background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }

        /* Rule Violation Display */
        .violation-badge { display: inline-block; background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; margin-right: 6px; margin-bottom: 4px; }

        /* Buttons */
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px; }
        .btn { padding: 10px 14px; border: none; border-radius: 8px; font-size: 0.85em; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary { background: linear-gradient(45deg, #6366f1, #8b5cf6); color: #fff; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(99, 102, 241, 0.4); }
        .btn-secondary { background: rgba(99, 102, 241, 0.15); color: #6366f1; border: 1px solid rgba(99, 102, 241, 0.3); }
        .btn-secondary:hover { background: rgba(99, 102, 241, 0.25); }

        /* Session Stats */
        .stat-block { text-align: center; padding: 12px; background: rgba(99, 102, 241, 0.08); border-radius: 8px; margin-bottom: 10px; }
        .stat-value { font-size: 1.5em; font-weight: 700; color: #6366f1; }
        .stat-label { font-size: 0.8em; color: #9ca3af; margin-top: 4px; }

        /* Empty State */
        .empty-state { text-align: center; padding: 20px; color: #9ca3af; font-size: 0.9em; }

        details.command-group { background: rgba(99, 102, 241, 0.08); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 10px; padding: 14px 18px; }
        details.command-group[open] { border-color: rgba(99, 102, 241, 0.4); }
        details.command-group summary { cursor: pointer; font-weight: 600; color: #e0e6f0; outline: none; }
        details.command-group summary::-webkit-details-marker { display: none; }
        details.command-group summary::after { content: '▾'; float: right; transition: transform 0.2s ease; color: #9ca3af; }
        details.command-group[open] summary::after { transform: rotate(180deg); }
        .command-list { list-style: none; margin: 12px 0 0; padding: 0; display: flex; flex-direction: column; gap: 8px; }
        .command-list li { color: #9ca3af; font-size: 0.9em; line-height: 1.5; }
        .command-list code { background: rgba(99, 102, 241, 0.18); color: #e0e6f0; padding: 2px 6px; border-radius: 4px; font-size: 0.85em; }

        @media (max-width: 768px) {
            .grid.two-column, .grid.three-column { grid-template-columns: 1fr; }
            h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="header-content">
            <h1>Wingman Command Center</h1>
            <div class="status-badge">
                <span class="status-dot"></span>
                <span>OPERATIONAL</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ROW 1: COMPACT ACCOUNT + MONTHLY GOAL (TWO COLUMN) -->
        <div class="grid two-column">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Trading Status</div>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Balance</span>
                    <span class="metric-value" id="account-balance">--</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Today P/L</span>
                    <span class="metric-value" id="today-pnl">--</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">YTD P/L</span>
                    <span class="metric-value positive" id="account-ytd">--</span>
                </div>
                <div class="limit-tracker">
                    <div class="limit-label">Daily Loss Limit</div>
                    <div class="limit-bar-container">
                        <div class="limit-bar" id="loss-limit-bar" style="width: 8%"></div>
                    </div>
                    <div class="limit-text">
                        <span id="loss-used">$21 / $250</span>
                        <span class="limit-status" id="loss-status">SAFE</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Monthly Goal</div>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Target</span>
                    <span class="metric-value">$2,500</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Progress</span>
                    <span class="metric-value positive" id="monthly-progress">--</span>
                </div>
                <div class="limit-tracker">
                    <div class="limit-label">Goal Progress</div>
                    <div class="limit-bar-container">
                        <div class="limit-bar" id="monthly-goal-bar" style="width: 0%; background: linear-gradient(90deg, #8b5cf6, #6366f1);"></div>
                    </div>
                    <div class="limit-text">
                        <span id="monthly-amount">$0 / $2,500</span>
                        <span class="limit-status" id="monthly-status">--</span>
                    </div>
                </div>
                <div class="card-detail" style="margin-top: 12px;">
                    <span id="daily-rate">Daily Rate: $83/day</span>
                </div>
            </div>
        </div>

        <!-- ROW 2: RULE COMPLIANCE + PRE-ENTRY THREAT ASSESSMENT (SIDE BY SIDE) -->
        <div class="grid two-column">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Rule Compliance (Today)</div>
                </div>
                <div id="compliance-container">
                    <div class="empty-state">No trades yet</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Pre-Entry Threat Assessment Checklist</div>
                </div>
                <div id="threat-checklist">
                    <div class="checklist-item">
                        <div class="checkbox" onclick="toggleCheck(this)">✓</div>
                        <label class="checklist-label">C+R Confirmation (close+retest)</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox" onclick="toggleCheck(this)">✓</div>
                        <label class="checklist-label">EMA Filter (5-min 200 EMA direction)</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox" onclick="toggleCheck(this)">✓</div>
                        <label class="checklist-label">Volume ≥ 1.3× 20-bar average</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox" onclick="toggleCheck(this)">✓</div>
                        <label class="checklist-label">ADD Confirmation (breadth direction)</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox" onclick="toggleCheck(this)">✓</div>
                        <label class="checklist-label">Signal Tier ≥ MODERATE</label>
                    </div>
                    <div class="checklist-item">
                        <div class="checkbox" onclick="toggleCheck(this)">✓</div>
                        <label class="checklist-label">Risk Calculated ($231 max)</label>
                    </div>
                    <div class="checklist-status notready" id="checklist-status">✗ CRITERIA NOT MET - WAIT</div>
                </div>
            </div>
        </div>

        <!-- ROW 3: ACTIVE POSITION (CONDITIONAL) -->
        <div class="grid full-width" id="active-position-row" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Active Position</div>
                </div>
                <div id="active-position-container"></div>
            </div>
        </div>

        <!-- ROW 5: SESSION PERFORMANCE + RECENT TRADES -->
        <div class="grid two-column">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Session Performance</div>
                </div>
                <div class="stat-block">
                    <div class="stat-value" id="session-trades">1</div>
                    <div class="stat-label">Trades Executed</div>
                </div>
                <div class="stat-block">
                    <div class="stat-value" id="session-winrate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-block">
                    <div class="stat-value" id="session-compliance">0%</div>
                    <div class="stat-label">Rule Compliance</div>
                </div>
                <div id="session-pattern" class="card-detail" style="margin-top: 12px;"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Recent Trades</div>
                </div>
                <div id="recent-trades-container">
                    <div class="empty-state">No trades recorded yet</div>
                </div>
            </div>
        </div>

        <!-- ROW 7: PORTFOLIO COMMAND DECK -->
        <div class="grid full-width">
            <div class="card portfolio-card">
                <div class="card-header">
                    <div class="card-title">Long Term Portfolio</div>
                    <div class="portfolio-subtitle">Situational read • refreshed with each dashboard sync</div>
                </div>
                <div class="portfolio-highlight">
                    <div class="portfolio-band">
                        <div class="portfolio-band-title">⚡ Active Stance</div>
                    </div>
                    <div class="portfolio-chips">
                        <span class="portfolio-chip">💰 Liquidity Ready: $46K</span>
                        <span class="portfolio-chip">🛡️ Risk Tier: Moderate</span>
                        <span class="portfolio-chip">🔥 Spotlight Asset: SOL</span>
                    </div>
                </div>
                <div class="portfolio-thesis">
                    <div class="portfolio-section-title">🧭 Portfolio Thesis</div>
                    <p class="card-detail" style="margin-bottom: 12px;">
                        Core positioning leans on crypto momentum with ample cash kept ready for asymmetric shots in equities. 
                    </p>
                    <ul>
                        <li>🔒 Maintain BTC and ETH core stack while trimming back only if allocation creeps above 55% of total capital.</li>
                        <li>🚀 Lean into SOL leadership - add on pullbacks toward $185 with confirmation from higher time frame trend.</li>
                        <li>🛡️ Keep $46K cash liquid for selective stock entries (QS, ARKX, TSLA) once market signal upgrades to MODERATE+.</li>
                    </ul>
                </div>
                <div class="portfolio-summary">
                    <div class="portfolio-summary-item">
                        <div class="portfolio-summary-label">💼 Total Portfolio</div>
                        <div class="portfolio-summary-value">$90,044.47</div>
                        <div class="portfolio-summary-note">100% allocation</div>
                    </div>
                    <div class="portfolio-summary-item">
                        <div class="portfolio-summary-label">💰 Cash</div>
                        <div class="portfolio-summary-value">$46,000.00</div>
                        <div class="portfolio-summary-note">51.1% allocation</div>
                    </div>
                    <div class="portfolio-summary-item">
                        <div class="portfolio-summary-label">🔥 Crypto</div>
                        <div class="portfolio-summary-value">$43,798.64</div>
                        <div class="portfolio-summary-note">48.6% allocation</div>
                    </div>
                    <div class="portfolio-summary-item">
                        <div class="portfolio-summary-label">📈 Stocks</div>
                        <div class="portfolio-summary-value">$245.83</div>
                        <div class="portfolio-summary-note">0.3% allocation</div>
                    </div>
                </div>
                <div class="portfolio-cash-callout">
                    <strong>💵 Cash Reserve</strong>
                    $46,000.00 earmarked for high-conviction setups (51.1% of portfolio)
                </div>
                <div class="portfolio-breakdown">
                    <div>
                        <div class="portfolio-section-title">🪙 Crypto Holdings</div>
                        <table class="portfolio-table">
                            <thead>
                                <tr>
                                    <th>Asset</th>
                                    <th>Holdings</th>
                                    <th>Asset Price</th>
                                    <th>Value</th>
                                    <th>Weight</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Bitcoin</td>
                                    <td class="value">0.1105</td>
                                    <td class="value">$113,999.50</td>
                                    <td class="value">$12,598.27</td>
                                    <td class="value">28.76%</td>
                                </tr>
                                <tr>
                                    <td>Ethereum</td>
                                    <td class="value">2.0619</td>
                                    <td class="value">$4,116.06</td>
                                    <td class="value">$8,487.09</td>
                                    <td class="value">19.38%</td>
                                </tr>
                                <tr>
                                    <td>Solana</td>
                                    <td class="value">97.6603</td>
                                    <td class="value">$201.44</td>
                                    <td class="value">$19,672.70</td>
                                    <td class="value">44.92%</td>
                                </tr>
                                <tr>
                                    <td>Litecoin</td>
                                    <td class="value">0.2789</td>
                                    <td class="value">$99.70</td>
                                    <td class="value">$27.80</td>
                                    <td class="value">0.06%</td>
                                </tr>
                                <tr>
                                    <td>Dogecoin</td>
                                    <td class="value">14,604.7119</td>
                                    <td class="value">$0.2011</td>
                                    <td class="value">$2,937.64</td>
                                    <td class="value">6.71%</td>
                                </tr>
                                <tr>
                                    <td>Avalanche</td>
                                    <td class="value">1.2732</td>
                                    <td class="value">$20.45</td>
                                    <td class="value">$26.04</td>
                                    <td class="value">0.06%</td>
                                </tr>
                                <tr>
                                    <td>Luna</td>
                                    <td class="value">22,030</td>
                                    <td class="value">$0.00005</td>
                                    <td class="value">$1.00</td>
                                    <td class="value">0.00%</td>
                                </tr>
                                <tr>
                                    <td>Near Protocol</td>
                                    <td class="value">2.5356</td>
                                    <td class="value">$2.34</td>
                                    <td class="value">$5.93</td>
                                    <td class="value">0.01%</td>
                                </tr>
                                <tr>
                                    <td>Raydium</td>
                                    <td class="value">22.92</td>
                                    <td class="value">$1.84</td>
                                    <td class="value">$42.17</td>
                                    <td class="value">0.10%</td>
                                </tr>
                                <tr class="portfolio-total-row">
                                    <td>Crypto Total</td>
                                    <td></td>
                                    <td></td>
                                    <td class="value">$43,798.64</td>
                                    <td class="value">48.6%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <div class="portfolio-section-title">📊 Stock Holdings</div>
                        <table class="portfolio-table">
                            <thead>
                                <tr>
                                    <th>Ticker</th>
                                    <th>Shares</th>
                                    <th>Price</th>
                                    <th>Value</th>
                                    <th>Weight</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ARKX</td>
                                    <td class="value">2</td>
                                    <td class="value">$31.05</td>
                                    <td class="value">$62.10</td>
                                    <td class="value">25.26%</td>
                                </tr>
                                <tr>
                                    <td>TSLA</td>
                                    <td class="value">0.0907</td>
                                    <td class="value">$452.42</td>
                                    <td class="value">$41.05</td>
                                    <td class="value">16.70%</td>
                                </tr>
                                <tr>
                                    <td>QS</td>
                                    <td class="value">8.7640</td>
                                    <td class="value">$16.28</td>
                                    <td class="value">$142.68</td>
                                    <td class="value">58.04%</td>
                                </tr>
                                <tr class="portfolio-total-row">
                                    <td>Stock Total</td>
                                    <td></td>
                                    <td></td>
                                    <td class="value">$245.83</td>
                                    <td class="value">0.3%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 8: END OF DAY RECAP (COLLAPSED BY DEFAULT) -->
        <div class="grid full-width">
            <div class="card" id="eod-recap-container"></div>
        </div>

        <!-- ROW 9: COMMAND REFERENCE (COLLAPSED) -->
        <div class="grid full-width">
            <div class="card">
                <details class="command-group">
                    <summary>Wingman Commands Reference</summary>
                    <ul class="command-list">
                        <li><code>wingman, status</code> - Full system readout</li>
                        <li><code>wingman, signal</code> - Current market signal</li>
                        <li><code>wingman, rules</code> - Active trading rules</li>
                        <li><code>wingman, analyze [TICKER]</code> - Full probability breakdown</li>
                        <li><code>NVDA long 100 @ 189.50, stop 188, target 192</code> - Log entry</li>
                        <li><code>Out at [PRICE]</code> - Close position</li>
                        <li><code>wingman, eod wrap</code> - End-of-day summary</li>
                    </ul>
                </details>
            </div>
        </div>
    </div>

    <script>
        function toggleCheck(element) {
            element.classList.toggle('checked');
            updateChecklistStatus();
        }

        function updateChecklistStatus() {
            const checkboxes = document.querySelectorAll('#threat-checklist .checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.classList.contains('checked'));
            const statusEl = document.getElementById('checklist-status');

            if (allChecked) {
                statusEl.textContent = '✓ ALL CLEAR - READY TO TRADE';
                statusEl.className = 'checklist-status ready';
            } else {
                statusEl.textContent = '✗ CRITERIA NOT MET - WAIT';
                statusEl.className = 'checklist-status notready';
            }
        }

        async function refreshDashboard() {
            try {
                const stateResponse = await fetch('./.session_state.json');
                const state = await stateResponse.json();

                const ledgerResponse = await fetch('./trades_ledger.json');
                const ledger = await ledgerResponse.json();

                // Update Account Status
                const balance = state.account?.balance || 0;
                const ytdPl = state.account?.ytd_pl || 0;
                const todayPnl = state.account?.today_pnl || 0;

                document.getElementById('account-balance').textContent = `$${balance.toLocaleString('en-US', {maximumFractionDigits: 2})}`;
                document.getElementById('account-ytd').textContent = `$${ytdPl.toLocaleString('en-US', {maximumFractionDigits: 2})}`;

                const todayEl = document.getElementById('today-pnl');
                todayEl.textContent = `$${Math.abs(todayPnl).toLocaleString('en-US', {maximumFractionDigits: 2})}`;
                todayEl.className = `metric-value ${todayPnl >= 0 ? 'positive' : 'negative'}`;

                // Update Daily Loss Limit
                updateLossLimitDisplay(todayPnl);

                // Update Rule Compliance (use ledger data)
                updateRuleComplianceFromLedger(ledger);

                // Update Recent Trades (use ledger data)
                updateRecentTradesFromLedger(ledger);

                // Update Session Performance (use ledger data)
                updateSessionPerformanceFromLedger(ledger);

                // Update Monthly Goal Tracker
                updateMonthlyGoal(ytdPl);

            } catch (error) {
                console.error('Error refreshing dashboard:', error);
            }
        }

        function updateMonthlyGoal(ytdPl) {
            const monthlyGoal = 2500;
            const today = new Date();
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const dayOfMonth = today.getDate();
            const daysRemaining = daysInMonth - dayOfMonth;

            // For monthly tracking, we'll use a simplified approach:
            // If we're early in the month, use YTD as proxy for current month
            // This assumes the user tracks monthly independently
            const monthlyProgress = ytdPl; // Simplified - in production would pull actual month P&L
            const percentage = (monthlyProgress / monthlyGoal) * 100;
            const dailyRequired = monthlyGoal / daysInMonth;
            const dailyAverage = dayOfMonth > 0 ? monthlyProgress / dayOfMonth : 0;

            // Update progress bar
            const bar = document.getElementById('monthly-goal-bar');
            bar.style.width = Math.min(100, percentage) + '%';

            // Update amount display
            document.getElementById('monthly-amount').textContent = `$${monthlyProgress.toFixed(2)} / $${monthlyGoal}`;
            document.getElementById('monthly-progress').textContent = `${percentage.toFixed(1)}%`;

            // Update daily rate display
            const rateText = dailyAverage > 0 ? `Daily Rate: $${dailyAverage.toFixed(0)}/day` : `Daily Target: $${dailyRequired.toFixed(0)}/day`;
            document.getElementById('daily-rate').textContent = rateText;

            // Update status
            const statusEl = document.getElementById('monthly-status');
            if (percentage >= 100) {
                statusEl.textContent = 'GOAL MET ✓';
                statusEl.className = 'limit-status';
                statusEl.style.color = '#10b981';
            } else if (percentage >= 75) {
                statusEl.textContent = 'ON PACE';
                statusEl.className = 'limit-status';
                statusEl.style.color = '#10b981';
            } else if (percentage >= 50) {
                statusEl.textContent = 'HALFWAY';
                statusEl.className = 'limit-status';
                statusEl.style.color = '#f59e0b';
            } else {
                statusEl.textContent = 'BUILDING';
                statusEl.className = 'limit-status';
                statusEl.style.color = '#6366f1';
            }
        }

        function updateRuleComplianceFromLedger(ledger) {
            const container = document.getElementById('compliance-container');
            const stats = ledger.statistics;

            if (!stats) {
                container.innerHTML = '<div class="empty-state">No ledger data</div>';
                return;
            }

            const latestTrade = ledger.trades[ledger.trades.length - 1];
            const violations = latestTrade?.rule_violations || [];

            let html = `
                <div class="metric-row">
                    <span class="metric-label">Total Trades</span>
                    <span class="metric-value">${stats.overall.total_trades}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Win Rate</span>
                    <span class="metric-value positive">${stats.overall.win_rate.toFixed(1)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Compliance Rate</span>
                    <span class="metric-value ${stats.compliance.compliance_percentage >= 80 ? 'positive' : 'negative'}">${stats.compliance.compliance_percentage.toFixed(1)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Profit Factor</span>
                    <span class="metric-value positive">${stats.performance.profit_factor.toFixed(2)}:1</span>
                </div>
                ${violations.length > 0 ? `<div style="margin-top: 12px;">${violations.slice(0, 2).map(v => `<span class="violation-badge">${v.substring(0, 30)}...</span>`).join('')}</div>` : ''}
                <div class="card-detail" style="margin-top: 12px; color: ${stats.compliance.compliance_percentage >= 80 ? '#10b981' : '#f59e0b'}">
                    ${stats.compliance.compliance_percentage >= 80 ? '✓ Good compliance trend' : '⚠️ Focus on checklist before entry'}
                </div>
            `;
            container.innerHTML = html;
        }

        function updateRecentTradesFromLedger(ledger) {
            const container = document.getElementById('recent-trades-container');
            const trades = ledger.trades || [];

            if (trades.length === 0) {
                container.innerHTML = '<div class="empty-state">No trades recorded</div>';
                return;
            }

            let html = '';
            [...trades].reverse().slice(0, 5).forEach(trade => {
                const pnl = trade.pnl || 0;
                const isProfitable = pnl >= 0;
                const hasViolations = (trade.rule_violations || []).length > 0;
                const itemClass = hasViolations ? 'violation' : (isProfitable ? 'win' : 'loss');

                html += `
                    <div class="trade-item ${itemClass}">
                        <div class="trade-header">
                            <span class="trade-symbol">${trade.symbol} ${trade.direction.toUpperCase().substring(0, 1)}</span>
                            <span class="trade-pnl ${isProfitable ? '' : 'loss'}">${isProfitable ? '+' : ''}$${Math.abs(pnl).toFixed(0)}</span>
                        </div>
                        <div class="trade-meta">
                            <span>${trade.date}</span>
                            <span>${trade.setup_type.substring(0, 25)}</span>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function updateSessionPerformanceFromLedger(ledger) {
            const stats = ledger.statistics;
            const trades = ledger.trades || [];

            document.getElementById('session-trades').textContent = stats.overall.total_trades;
            document.getElementById('session-winrate').textContent = stats.overall.win_rate.toFixed(0) + '%';
            document.getElementById('session-compliance').textContent = stats.compliance.compliance_percentage.toFixed(0) + '%';

            let pattern = `Trading started - ${stats.overall.total_trades} trades logged`;
            if (trades.length > 0) {
                const violations = stats.compliance.total_violations;
                if (violations > 0) {
                    pattern = `Pattern: ${violations} violation(s) detected. Focus: Run threat assessment BEFORE entry.`;
                } else if (stats.overall.win_rate >= 60) {
                    pattern = 'Pattern: High win rate with discipline ✓';
                } else if (stats.compliance.compliance_percentage >= 80) {
                    pattern = 'Pattern: Strong compliance, building consistency';
                } else {
                    pattern = 'Pattern: Learning phase - compliance improving';
                }
            }

            document.getElementById('session-pattern').textContent = pattern;
        }

        function updateLossLimitDisplay(todayPnl) {
            const dailyLimit = 250;
            const used = Math.abs(todayPnl);
            const remaining = dailyLimit - used;
            const percentage = (used / dailyLimit) * 100;

            const bar = document.getElementById('loss-limit-bar');
            bar.style.width = percentage + '%';

            let statusClass = 'limit-status';
            let statusText = 'SAFE';
            if (percentage >= 80) {
                statusClass += ' danger';
                statusText = 'DANGER';
            } else if (percentage >= 50) {
                statusClass += ' warning';
                statusText = 'WARNING';
            }

            document.getElementById('loss-status').className = statusClass;
            document.getElementById('loss-status').textContent = statusText;
            document.getElementById('loss-used').textContent = `$${used.toFixed(2)} / $${dailyLimit}`;

            if (percentage >= 80) {
                bar.className = 'limit-bar danger';
            } else if (percentage >= 50) {
                bar.className = 'limit-bar warning';
            }
        }

        function updateRuleCompliance(state) {
            const container = document.getElementById('compliance-container');
            const recentTrades = state.account?.recent_trades || [];

            if (recentTrades.length === 0) {
                container.innerHTML = '<div class="empty-state">No trades yet - no compliance data</div>';
                return;
            }

            const lastTrade = recentTrades[0];
            const violations = (lastTrade.raw_notes || '').match(/Rule \d+/g) || [];

            let html = `
                <div class="metric-row">
                    <span class="metric-label">Total Trades</span>
                    <span class="metric-value">${recentTrades.length}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Last Trade Violations</span>
                    <span class="metric-value">${violations.length > 0 ? violations.length : '0'}</span>
                </div>
                ${violations.length > 0 ? `<div style="margin-top: 12px;">${violations.map(v => `<span class="violation-badge">${v}</span>`).join('')}</div>` : ''}
                <div class="card-detail" style="margin-top: 12px; color: ${violations.length > 0 ? '#ef4444' : '#10b981'}">
                    ${violations.length > 0 ? '⚠️ Violations detected in last trade' : '✓ Last trade compliant'}
                </div>
            `;
            container.innerHTML = html;
        }

        function updateRecentTrades(trades) {
            const container = document.getElementById('recent-trades-container');

            if (!trades || trades.length === 0) {
                container.innerHTML = '<div class="empty-state">No trades recorded yet</div>';
                return;
            }

            let html = '';
            trades.slice(0, 5).forEach(trade => {
                const pnl = trade.pnl || 0;
                const isProfitable = pnl >= 0;
                const hasViolations = (trade.raw_notes || '').includes('Rule');
                const itemClass = hasViolations ? 'violation' : (isProfitable ? 'win' : 'loss');

                html += `
                    <div class="trade-item ${itemClass}">
                        <div class="trade-header">
                            <span class="trade-symbol">${trade.symbol || '--'}</span>
                            <span class="trade-pnl ${isProfitable ? '' : 'loss'}">${isProfitable ? '+' : ''}$${Math.abs(pnl).toFixed(2)}</span>
                        </div>
                        <div class="trade-meta">
                            <span>${trade.date || '--'} ${trade.time || ''}</span>
                            <span>${trade.setup_type || '--'}</span>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function updateSessionPerformance(state) {
            const trades = state.account?.recent_trades || [];
            const wins = trades.filter(t => (t.pnl || 0) > 0).length;
            const winRate = trades.length > 0 ? Math.round((wins / trades.length) * 100) : 0;
            const violations = trades.filter(t => (t.raw_notes || '').includes('Rule')).length;
            const compliance = trades.length > 0 ? Math.round(((trades.length - violations) / trades.length) * 100) : 0;

            document.getElementById('session-trades').textContent = trades.length;
            document.getElementById('session-winrate').textContent = winRate + '%';
            document.getElementById('session-compliance').textContent = compliance + '%';

            let pattern = 'Pattern: Starting fresh session';
            if (trades.length > 0) {
                if (violations > 0) {
                    pattern = `Pattern: ${violations} rule violation${violations > 1 ? 's' : ''} (${compliance}% compliance)`;
                } else if (winRate >= 50) {
                    pattern = 'Pattern: Disciplined execution ✓';
                } else {
                    pattern = 'Pattern: Learning phase - focus on rules';
                }
            }

            document.getElementById('session-pattern').textContent = pattern;
        }

        // Render End of Day Recap (collapsed by default)
        function renderEndOfDayRecap(recapData) {
            if (!recapData) return null;

            const section = document.createElement('div');
            section.style.borderTop = '1px solid rgba(99, 102, 241, 0.2)';
            section.style.paddingTop = '20px';

            // Header with collapsible toggle
            const header = document.createElement('div');
            header.style.display = 'flex';
            header.style.justifyContent = 'space-between';
            header.style.alignItems = 'center';
            header.style.marginBottom = '15px';

            const title = document.createElement('h3');
            title.textContent = `📊 End of Day Recap - ${recapData.date || 'Previous Day'}`;
            title.style.margin = '0';
            title.style.color = '#e0e6f0';
            title.style.fontSize = '1.1em';
            title.style.fontWeight = '600';

            // Timestamp
            const timestamp = document.createElement('div');
            timestamp.style.fontSize = '0.85em';
            timestamp.style.marginLeft = '12px';

            if (recapData.ranAt) {
                const eodTime = new Date(recapData.ranAt);
                const now = new Date();
                const hoursSinceEOD = (now - eodTime) / (1000 * 60 * 60);
                const isStale = hoursSinceEOD > 24;

                if (isStale) {
                    timestamp.style.color = '#ef4444';
                    timestamp.style.fontWeight = '600';
                    timestamp.innerHTML = `⚠️ Stale data from ${recapData.date}`;
                } else {
                    timestamp.style.color = '#9ca3af';
                    timestamp.textContent = recapData.ranAt;
                }
            }

            // Toggle Button
            const content = document.createElement('div');
            content.id = 'eod-recap-content';
            content.style.display = 'none'; // Collapsed by default

            const toggleButton = document.createElement('button');
            toggleButton.style.background = 'rgba(99, 102, 241, 0.2)';
            toggleButton.style.border = '1px solid rgba(99, 102, 241, 0.4)';
            toggleButton.style.color = '#6366f1';
            toggleButton.style.padding = '6px 12px';
            toggleButton.style.borderRadius = '6px';
            toggleButton.style.cursor = 'pointer';
            toggleButton.style.fontSize = '0.9em';
            toggleButton.style.fontWeight = '600';
            toggleButton.textContent = '▼ Show';
            toggleButton.onclick = function() {
                const isHidden = content.style.display === 'none';
                content.style.display = isHidden ? 'block' : 'none';
                this.textContent = isHidden ? '▲ Hide' : '▼ Show';
            };

            header.appendChild(title);
            if (timestamp.textContent || timestamp.innerHTML) header.appendChild(timestamp);
            header.appendChild(toggleButton);
            section.appendChild(header);

            // Summary paragraph
            if (recapData.summary) {
                const summaryDiv = document.createElement('div');
                summaryDiv.style.background = 'rgba(99, 102, 241, 0.1)';
                summaryDiv.style.border = '1px solid rgba(99, 102, 241, 0.2)';
                summaryDiv.style.borderRadius = '8px';
                summaryDiv.style.padding = '15px';
                summaryDiv.style.marginBottom = '15px';
                summaryDiv.style.color = '#e0e6f0';
                summaryDiv.style.lineHeight = '1.6';
                summaryDiv.textContent = recapData.summary;
                content.appendChild(summaryDiv);
            }

            // Key Outcomes
            if (recapData.keyOutcomes && recapData.keyOutcomes.length) {
                const outcomesSection = document.createElement('div');
                outcomesSection.style.marginBottom = '15px';

                const outcomesTitle = document.createElement('h4');
                outcomesTitle.style.color = '#6366f1';
                outcomesTitle.style.fontSize = '1em';
                outcomesTitle.style.marginBottom = '8px';
                outcomesTitle.textContent = '🎯 Key Outcomes';
                outcomesSection.appendChild(outcomesTitle);

                const outcomesList = document.createElement('ul');
                outcomesList.style.color = '#e0e6f0';
                outcomesList.style.lineHeight = '1.7';
                outcomesList.style.marginLeft = '20px';

                recapData.keyOutcomes.forEach(outcome => {
                    const li = document.createElement('li');
                    li.textContent = outcome;
                    li.style.marginBottom = '6px';
                    outcomesList.appendChild(li);
                });

                outcomesSection.appendChild(outcomesList);
                content.appendChild(outcomesSection);
            }

            // Signals Snapshot
            if (recapData.signals) {
                const signalsSection = document.createElement('div');
                signalsSection.style.marginBottom = '15px';
                signalsSection.style.background = 'rgba(16, 185, 129, 0.1)';
                signalsSection.style.border = '1px solid rgba(16, 185, 129, 0.2)';
                signalsSection.style.borderRadius = '8px';
                signalsSection.style.padding = '12px';

                const signalsTitle = document.createElement('h4');
                signalsTitle.style.color = '#10b981';
                signalsTitle.style.fontSize = '1em';
                signalsTitle.style.marginBottom = '8px';
                signalsTitle.textContent = '📈 Signals Snapshot';
                signalsSection.appendChild(signalsTitle);

                const signalsText = document.createElement('div');
                signalsText.style.color = '#e0e6f0';
                signalsText.style.lineHeight = '1.6';
                signalsText.innerHTML = `
                    <strong>Composite:</strong> ${recapData.signals.composite || 'N/A'}/100 (${recapData.signals.tier || 'N/A'})<br>
                    <strong>Drivers:</strong> ${(recapData.signals.drivers || []).join(', ')}<br>
                    <strong>X Sentiment:</strong> ${recapData.signals.xSentiment || 'N/A'}
                `;
                signalsSection.appendChild(signalsText);
                content.appendChild(signalsSection);
            }

            // Signal Score Trend (7-Day)
            if (recapData.trendAnalysis && recapData.trendAnalysis.signalScoreTrend) {
                const trendSection = document.createElement('div');
                trendSection.style.marginBottom = '15px';
                trendSection.style.background = 'rgba(99, 102, 241, 0.1)';
                trendSection.style.border = '1px solid rgba(99, 102, 241, 0.2)';
                trendSection.style.borderRadius = '8px';
                trendSection.style.padding = '12px';

                const trendTitle = document.createElement('h4');
                trendTitle.style.color = '#6366f1';
                trendTitle.style.fontSize = '1em';
                trendTitle.style.marginBottom = '8px';
                trendTitle.textContent = '📊 Signal Score Trend (7-Day)';
                trendSection.appendChild(trendTitle);

                const trend = recapData.trendAnalysis.signalScoreTrend;

                // Mini chart display
                const chartContainer = document.createElement('div');
                chartContainer.style.display = 'flex';
                chartContainer.style.alignItems = 'flex-end';
                chartContainer.style.height = '60px';
                chartContainer.style.gap = '4px';
                chartContainer.style.marginBottom = '10px';

                if (trend.scores && trend.scores.length) {
                    const maxScore = Math.max(...trend.scores);
                    trend.scores.forEach((score, idx) => {
                        const bar = document.createElement('div');
                        bar.style.flex = '1';
                        bar.style.background = score >= 70 ? '#10b981' : score >= 50 ? '#6366f1' : '#f59e0b';
                        bar.style.height = `${(score / 100) * 60}px`;
                        bar.style.borderRadius = '4px 4px 0 0';
                        bar.style.position = 'relative';
                        bar.title = `Day ${idx + 1}: ${score}`;
                        chartContainer.appendChild(bar);
                    });
                }
                trendSection.appendChild(chartContainer);

                // Trend summary
                const trendSummary = document.createElement('div');
                trendSummary.style.color = '#e0e6f0';
                trendSummary.style.fontSize = '0.9em';
                trendSummary.style.lineHeight = '1.6';
                trendSummary.innerHTML = `
                    <strong>Trend:</strong> ${trend.direction || 'N/A'} (${trend.change || 'N/A'} points over 7 days)<br>
                    ${trend.tierTransitions ? `<strong>Tier Changes:</strong> ${trend.tierTransitions}<br>` : ''}
                    <strong>Analysis:</strong> ${trend.summary || 'No trend data available'}
                `;
                trendSection.appendChild(trendSummary);
                content.appendChild(trendSection);
            }

            // Volatility Pattern
            if (recapData.trendAnalysis && recapData.trendAnalysis.volatilityPattern) {
                const volSection = document.createElement('div');
                volSection.style.marginBottom = '15px';
                volSection.style.background = 'rgba(245, 158, 11, 0.1)';
                volSection.style.border = '1px solid rgba(245, 158, 11, 0.2)';
                volSection.style.borderRadius = '8px';
                volSection.style.padding = '12px';

                const volTitle = document.createElement('h4');
                volTitle.style.color = '#f59e0b';
                volTitle.style.fontSize = '1em';
                volTitle.style.marginBottom = '8px';
                volTitle.textContent = '⚡ Volatility Pattern';
                volSection.appendChild(volTitle);

                const vol = recapData.trendAnalysis.volatilityPattern;
                const volContent = document.createElement('div');
                volContent.style.color = '#e0e6f0';
                volContent.style.fontSize = '0.9em';
                volContent.style.lineHeight = '1.6';
                volContent.innerHTML = `
                    <strong>VIX Change:</strong> ${vol.vixChange || 'N/A'} (${vol.vixChangePercent || 'N/A'})<br>
                    <strong>Pattern:</strong> ${vol.pattern || 'Normal'} ${vol.isUnusual ? '⚠️ <span style="color: #ef4444;">UNUSUAL SPIKE</span>' : ''}<br>
                    <strong>Status:</strong> ${vol.status || 'N/A'}<br>
                    <strong>Context:</strong> ${vol.context || 'No pattern detected'}
                `;
                volSection.appendChild(volContent);
                content.appendChild(volSection);
            }

            // Breadth Divergence
            if (recapData.trendAnalysis && recapData.trendAnalysis.breadthDivergence) {
                const breadthSection = document.createElement('div');
                breadthSection.style.marginBottom = '15px';
                breadthSection.style.background = 'rgba(239, 68, 68, 0.1)';
                breadthSection.style.border = '1px solid rgba(239, 68, 68, 0.2)';
                breadthSection.style.borderRadius = '8px';
                breadthSection.style.padding = '12px';

                const breadthTitle = document.createElement('h4');
                breadthTitle.style.color = '#ef4444';
                breadthTitle.style.fontSize = '1em';
                breadthTitle.style.marginBottom = '8px';
                breadthTitle.textContent = '📉 Breadth Divergence';
                breadthSection.appendChild(breadthTitle);

                const breadth = recapData.trendAnalysis.breadthDivergence;
                const breadthContent = document.createElement('div');
                breadthContent.style.color = '#e0e6f0';
                breadthContent.style.fontSize = '0.9em';
                breadthContent.style.lineHeight = '1.6';
                breadthContent.innerHTML = `
                    <strong>Status:</strong> ${breadth.isDiverging ? '<span style="color: #ef4444;">⚠️ DIVERGING</span>' : '<span style="color: #10b981;">✓ ALIGNED</span>'}<br>
                    <strong>Consecutive Days:</strong> ${breadth.consecutiveDays || 0} day(s)<br>
                    <strong>Historical Context:</strong> ${breadth.historicalContext || 'N/A'}<br>
                    <strong>Implication:</strong> ${breadth.implication || 'Monitor for potential reversal or continuation'}
                `;
                breadthSection.appendChild(breadthContent);
                content.appendChild(breadthSection);
            }

            // Narrative Momentum
            if (recapData.trendAnalysis && recapData.trendAnalysis.narrativeMomentum) {
                const narrativeSection = document.createElement('div');
                narrativeSection.style.marginBottom = '15px';
                narrativeSection.style.background = 'rgba(139, 92, 246, 0.1)';
                narrativeSection.style.border = '1px solid rgba(139, 92, 246, 0.2)';
                narrativeSection.style.borderRadius = '8px';
                narrativeSection.style.padding = '12px';

                const narrativeTitle = document.createElement('h4');
                narrativeTitle.style.color = '#8b5cf6';
                narrativeTitle.style.fontSize = '1em';
                narrativeTitle.style.marginBottom = '8px';
                narrativeTitle.textContent = '🔥 Narrative Momentum';
                narrativeSection.appendChild(narrativeTitle);

                const narratives = recapData.trendAnalysis.narrativeMomentum;

                // Hot narratives
                if (narratives.hot && narratives.hot.length) {
                    const hotDiv = document.createElement('div');
                    hotDiv.style.marginBottom = '10px';
                    hotDiv.innerHTML = '<strong style="color: #10b981;">📈 Gaining Steam:</strong>';
                    const hotList = document.createElement('ul');
                    hotList.style.marginLeft = '20px';
                    hotList.style.marginTop = '5px';
                    hotList.style.color = '#e0e6f0';
                    narratives.hot.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `<strong>${item.narrative}</strong> - ${item.trend} (${item.days} days)`;
                        hotList.appendChild(li);
                    });
                    hotDiv.appendChild(hotList);
                    narrativeSection.appendChild(hotDiv);
                }

                // Cooling narratives
                if (narratives.cooling && narratives.cooling.length) {
                    const coolingDiv = document.createElement('div');
                    coolingDiv.innerHTML = '<strong style="color: #f59e0b;">📉 Losing Steam:</strong>';
                    const coolingList = document.createElement('ul');
                    coolingList.style.marginLeft = '20px';
                    coolingList.style.marginTop = '5px';
                    coolingList.style.color = '#e0e6f0';
                    narratives.cooling.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `<strong>${item.narrative}</strong> - ${item.trend} (${item.days} days)`;
                        coolingList.appendChild(li);
                    });
                    coolingDiv.appendChild(coolingList);
                    narrativeSection.appendChild(coolingDiv);
                }

                content.appendChild(narrativeSection);
            }

            // Actions
            if (recapData.actions) {
                const actionsSection = document.createElement('div');
                actionsSection.style.marginBottom = '15px';

                const actionsTitle = document.createElement('h4');
                actionsTitle.style.color = '#6366f1';
                actionsTitle.style.fontSize = '1em';
                actionsTitle.style.marginBottom = '8px';
                actionsTitle.textContent = '✅ Actions';
                actionsSection.appendChild(actionsTitle);

                if (recapData.actions.completed && recapData.actions.completed.length) {
                    const completedLabel = document.createElement('div');
                    completedLabel.style.color = '#10b981';
                    completedLabel.style.fontWeight = '600';
                    completedLabel.style.marginTop = '8px';
                    completedLabel.textContent = 'Completed:';
                    actionsSection.appendChild(completedLabel);

                    const completedList = document.createElement('ul');
                    completedList.style.color = '#e0e6f0';
                    completedList.style.lineHeight = '1.7';
                    completedList.style.marginLeft = '20px';
                    completedList.style.marginBottom = '8px';

                    recapData.actions.completed.forEach(action => {
                        const li = document.createElement('li');
                        li.textContent = action;
                        li.style.marginBottom = '4px';
                        completedList.appendChild(li);
                    });

                    actionsSection.appendChild(completedList);
                }

                if (recapData.actions.deferred && recapData.actions.deferred.length) {
                    const deferredLabel = document.createElement('div');
                    deferredLabel.style.color = '#f59e0b';
                    deferredLabel.style.fontWeight = '600';
                    deferredLabel.style.marginTop = '8px';
                    deferredLabel.textContent = 'Deferred:';
                    actionsSection.appendChild(deferredLabel);

                    const deferredList = document.createElement('ul');
                    deferredList.style.color = '#e0e6f0';
                    deferredList.style.lineHeight = '1.7';
                    deferredList.style.marginLeft = '20px';

                    recapData.actions.deferred.forEach(action => {
                        const li = document.createElement('li');
                        li.textContent = action;
                        li.style.marginBottom = '4px';
                        deferredList.appendChild(li);
                    });

                    actionsSection.appendChild(deferredList);
                }

                content.appendChild(actionsSection);
            }

            // Notes
            if (recapData.notes) {
                const notesDiv = document.createElement('div');
                notesDiv.style.background = 'rgba(245, 158, 11, 0.1)';
                notesDiv.style.border = '1px solid rgba(245, 158, 11, 0.2)';
                notesDiv.style.borderRadius = '8px';
                notesDiv.style.padding = '12px';
                notesDiv.style.color = '#e0e6f0';
                notesDiv.style.lineHeight = '1.6';
                notesDiv.innerHTML = `<strong style="color: #f59e0b;">💡 Notes:</strong> ${recapData.notes}`;
                content.appendChild(notesDiv);
            }

            section.appendChild(content);
            return section;
        }

        async function loadEndOfDayRecap() {
            try {
                const response = await fetch('./.eod_recap.json');
                if (response.ok) {
                    const eodData = await response.json();
                    const container = document.getElementById('eod-recap-container');
                    const eodElement = renderEndOfDayRecap(eodData);
                    if (eodElement) {
                        container.innerHTML = '';
                        container.appendChild(eodElement);
                    }
                } else {
                    // No data file exists yet - show placeholder
                    showEODPlaceholder();
                }
            } catch (error) {
                // EOD data not yet available - show placeholder
                showEODPlaceholder();
            }
        }

        function showEODPlaceholder() {
            const container = document.getElementById('eod-recap-container');
            if (!container) return;

            const placeholder = document.createElement('div');
            placeholder.style.borderTop = '1px solid rgba(99, 102, 241, 0.2)';
            placeholder.style.paddingTop = '20px';

            const header = document.createElement('div');
            header.style.display = 'flex';
            header.style.justifyContent = 'space-between';
            header.style.alignItems = 'center';
            header.style.marginBottom = '15px';

            const title = document.createElement('h3');
            title.textContent = '📊 End of Day Recap';
            title.style.margin = '0';
            title.style.color = '#e0e6f0';
            title.style.fontSize = '1.1em';
            title.style.fontWeight = '600';

            const status = document.createElement('div');
            status.style.fontSize = '0.85em';
            status.style.color = '#9ca3af';
            status.textContent = 'Awaiting EOD data';

            header.appendChild(title);
            header.appendChild(status);
            placeholder.appendChild(header);

            const message = document.createElement('div');
            message.style.background = 'rgba(99, 102, 241, 0.08)';
            message.style.border = '1px solid rgba(99, 102, 241, 0.2)';
            message.style.borderRadius = '8px';
            message.style.padding = '15px';
            message.style.color = '#9ca3af';
            message.style.fontSize = '0.9em';
            message.style.lineHeight = '1.6';
            message.innerHTML = 'Run <code style="background: rgba(99, 102, 241, 0.3); padding: 2px 6px; border-radius: 4px;">wingman, eod wrap</code> at end of day to populate this section with market analysis, signal trends, and narrative momentum.';

            placeholder.appendChild(message);
            container.innerHTML = '';
            container.appendChild(placeholder);
        }

        document.addEventListener('DOMContentLoaded', () => {
            refreshDashboard();
            loadEndOfDayRecap();
            setInterval(refreshDashboard, 30000);
        });
    </script>
</body>
</html>
