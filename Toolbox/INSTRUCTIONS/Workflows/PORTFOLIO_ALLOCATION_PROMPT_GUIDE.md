# Portfolio Allocation AI Prompt Guide

**Phase**: 5 (AI Manual Update - runs after wingman_dash.py Phase 4)
**Script**: Generated by `scripts/automation/wingman_dash.py` Phase 5
**Purpose**: AI calculates tier-based allocation percentages and selects quality tickers for Portfolio tab

---

## Overview

The Portfolio tab displays a **Recommended Allocation** widget showing how to deploy capital across asset classes based on the current signal tier. This allocation is **calculated by AI** during wingman_dash.py Phase 5, not automated.

**Key Principle**: Allocation percentages are **tier-based** (STRONG/MODERATE/WEAK/AVOID), ensuring portfolio positioning aligns with market signal strength.

---

## When This Prompt Triggers

The Portfolio Allocation prompt is generated when `tabs.portfolio.portfolioRecommendation.updatedAt` is stale during wingman_dash.py Phase 5.

**Trigger Conditions**:
- portfolioRecommendation.updatedAt is >24 hours old
- OR missing timestamp
- OR explicit user request to update Portfolio tab

**Output from Phase 5**:
```
📌 tabs.portfolio.portfolioRecommendation
   ➜ Research Sources:
      • Research/.cache/signals_2025-10-24.json
      • Research/.cache/2025-10-24_Market_Sentiment_Overview.md
      • Journal/account_state.json

Portfolio Allocation will be calculated by AI (tier-based percentages + quality tickers)
```

---

## Research Sources to Read

When updating Portfolio Allocation, read these files:

1. **`Research/.cache/signals_{date}.json`** - Signal tier and composite score
   - Extract: `composite` score (0-100)
   - Extract: `tier` (STRONG/MODERATE/WEAK/AVOID)
   - Used to determine allocation percentages

2. **`Research/.cache/{date}_Market_Sentiment_Overview.md`** - Market context
   - Extract: Sector performance (Tech/Crypto/Defensive)
   - Extract: Structural themes (quantum computing, Bitcoin adoption, etc.)
   - Used to select specific quality tickers

3. **`Journal/account_state.json`** - Account balance (optional)
   - Extract: `balance` for context
   - NOT required for allocation calculation

---

## Tier-Based Allocation Guidelines

### STRONG (Signal 75-100)
**Allocation**: Aggressive risk deployment
- **Tech**: 40-50%
- **Crypto**: 30-40%
- **Cash**: 10-20%

**Rationale**: High signal strength justifies maximum risk exposure. Focus on quality growth names with strong technicals.

---

### MODERATE (Signal 60-74)
**Allocation**: Balanced positioning
- **Tech**: 25-35%
- **Crypto**: 20-30%
- **Cash**: 35-50%

**Rationale**: Moderate signal allows selective risk deployment but maintain meaningful cash buffer for volatility.

**Example** (Signal 58/100 - MODERATE):
```yaml
allocation:
  tech: 30
  crypto: 20
  cash: 50
```

---

### WEAK (Signal 45-59)
**Allocation**: Defensive positioning
- **Tech**: 15-25%
- **Crypto**: 10-20%
- **Cash**: 50-70%

**Rationale**: Weak signal mandates defensive posture. Only deploy in highest-quality names, maintain majority cash.

**Example** (Signal 28.5/100 - WEAK):
```yaml
allocation:
  tech: 20
  crypto: 15
  cash: 65
```

---

### AVOID (Signal <45)
**Allocation**: Ultra-defensive
- **Tech**: 5-15%
- **Crypto**: 5-10%
- **Cash**: 75-90%

**Rationale**: Very weak signal requires maximum capital preservation. Minimal exposure to only the highest-conviction mega-caps.

---

## Ticker Selection Rules

### Tech: Quality Mega-Caps Only
**Eligible Tickers**: AAPL, MSFT, META, NVDA, GOOGL, AMZN
**Selection Criteria**:
- Must be in Market_Sentiment_Overview as BULLISH or STRONG
- Prefer names with structural themes (quantum computing, AI infrastructure)
- Maximum 4-5 tickers to maintain quality focus

**Example**:
```yaml
tickers:
  tech: 'AAPL, MSFT, META, NVDA'
```

---

### Crypto: BTC/ETH Infrastructure with Entry Levels
**Eligible Assets**: BTC, ETH
**Selection Criteria**:
- Include specific entry levels from Market_Sentiment_Overview
- Reference support zones tested multiple times
- Mention structural themes (institutional adoption, Bittensor, Ledger)

**Example**:
```yaml
tickers:
  crypto: 'BTC/ETH @ $107-109k support'
```

---

### Defensive: Cash Equivalents + Catalysts
**Eligible Assets**: Cash, short-term treasuries, gold (GLD)
**Selection Criteria**:
- Reference upcoming catalysts (FOMC decision, CPI data)
- Indicate deployment window timing
- Specify "ready" or "waiting for [catalyst]"

**Example**:
```yaml
tickers:
  defensive: 'Cash ready for FOMC Oct 29'
```

---

## Output YAML Structure

Update these fields in `master-plan.md` → `tabs.portfolio.portfolioRecommendation`:

```yaml
portfolioRecommendation:
  updatedAt: '2025-10-24T14:30:00Z'  # ISO 8601 timestamp
  signalTier: MODERATE                # From signals_{date}.json
  signalScore: 58                     # From signals_{date}.json
  allocation:                         # Tier-based percentages
    tech: 30
    crypto: 20
    cash: 50
  tickers:                            # Quality names from research
    tech: 'AAPL, MSFT, META, NVDA'
    crypto: 'BTC/ETH @ $107-109k support'
    defensive: 'Cash ready for FOMC Oct 29'
```

**Critical**: `updatedAt` must be set to current ISO 8601 timestamp to mark allocation as current.

---

## Example Workflow

### Step 1: Read Signal Tier
**File**: `Research/.cache/signals_2025-10-24.json`
```json
{
  "composite": 58,
  "tier": "MODERATE"
}
```

**Action**: Signal 58/100 = MODERATE tier → Use 25-35% tech, 20-30% crypto, 35-50% cash

---

### Step 2: Read Market Context
**File**: `Research/.cache/2025-10-24_Market_Sentiment_Overview.md`

**Extract**:
- Tech sector: Quantum computing inflection (IBM, AMD partnerships) = BULLISH on NVDA, AMD
- Crypto: BTC $111,600 above $107-109k support = BULLISH on BTC/ETH
- Upcoming catalyst: FOMC decision Oct 29 = Keep cash ready

---

### Step 3: Calculate Allocation
**Signal Tier**: MODERATE (58/100)
**Allocation**:
- Tech: 30% (balanced within 25-35% range)
- Crypto: 20% (balanced within 20-30% range)
- Cash: 50% (defensive buffer for FOMC volatility)

---

### Step 4: Select Tickers
**Tech**: AAPL, MSFT, META, NVDA (quality mega-caps with quantum/AI exposure)
**Crypto**: BTC/ETH @ $107-109k support (specific entry levels)
**Defensive**: Cash ready for FOMC Oct 29 (catalyst reference)

---

### Step 5: Update YAML
```yaml
allocation:
  tech: 30
  crypto: 20
  cash: 50
tickers:
  tech: 'AAPL, MSFT, META, NVDA'
  crypto: 'BTC/ETH @ $107-109k support'
  defensive: 'Cash ready for FOMC Oct 29'
updatedAt: '2025-10-24T14:30:00Z'
```

---

## Validation Checklist

Before marking Portfolio Allocation as complete:

- [ ] allocation.tech + allocation.crypto + allocation.cash = 100
- [ ] Allocation percentages align with signal tier guidelines
- [ ] Tech tickers are quality mega-caps only (AAPL/MSFT/META/NVDA/GOOGL/AMZN)
- [ ] Crypto tickers include specific entry levels ($XXX-XXXk support)
- [ ] Defensive tickers reference upcoming catalysts (FOMC, CPI, etc.)
- [ ] updatedAt is current ISO 8601 timestamp
- [ ] All three ticker categories populated (tech, crypto, defensive)

---

## Dashboard Display

Once updated, the Portfolio tab displays the allocation widget:

```
┌─────────────────────────────────────────┐
│ 📊 Recommended Allocation               │
│                                         │
│       ╭─────────╮                       │
│       │   58    │  ← Signal Score       │
│       │ SIGNAL  │                       │
│       ╰─────────╯                       │
│                                         │
│ 🔵 30% Mega-cap Tech                    │
│    AAPL, MSFT, META, NVDA              │
│                                         │
│ 🟣 20% Crypto Contrarian                │
│    BTC/ETH @ $107-109k support         │
│                                         │
│ 🟢 50% Cash/Defensive                   │
│    Cash ready for FOMC Oct 29          │
└─────────────────────────────────────────┘
```

**Visual Elements**:
- Donut chart showing percentage split
- Signal score in center (from portfolioRecommendation.signalScore)
- Three segments with labels and ticker details

---

## Common Mistakes to Avoid

1. **Don't hardcode allocation percentages** → Use tier guidelines
2. **Don't select speculative tickers** → Quality mega-caps only
3. **Don't forget entry levels for crypto** → Include specific support zones
4. **Don't skip catalyst references** → Mention FOMC, CPI, etc. in defensive tickers
5. **Don't forget timestamp** → Update updatedAt to ISO 8601 current time
6. **Don't allow percentages to exceed 100** → Validate tech + crypto + cash = 100

---

## Integration with Wingman Dash Workflow

**Phase 1**: Timestamp verification (identifies stale portfolioRecommendation.updatedAt)
**Phase 2**: Automated sync scripts (not applicable to Portfolio Allocation)
**Phase 3**: Update master-plan.md (not applicable to allocation)
**Phase 4**: Final verification (checks if Portfolio allocation is still stale)
**Phase 5**: ⚠️ **CLAUDE AI MANUALLY UPDATES** → Read signals_{date}.json → Calculate allocation → Update YAML

**After Phase 5**: Dashboard displays fresh allocation widget with real data (not hardcoded 25/25/50)

---

## Related Documentation

- **Markets Intelligence AI Workflow**: `MARKETS_INTELLIGENCE_AI_UPDATE_WORKFLOW.md` (similar Phase 5 pattern)
- **X Sentiment Update Workflow**: `X_SENTIMENT_UPDATE_WORKFLOW.md` (automated data extraction example)
- **Wingman Dash Script**: `scripts/automation/wingman_dash.py` (Phase 5 prompt generation)
- **Master Plan Schema**: `master-plan/master-plan.md` (YAML structure reference)

---

## Summary

**Purpose**: AI calculates tier-based allocation percentages and selects quality tickers
**Trigger**: portfolioRecommendation.updatedAt is stale during wingman_dash.py Phase 5
**Input**: signals_{date}.json (tier) + Market_Sentiment_Overview.md (tickers)
**Output**: allocation object + tickers object + updatedAt timestamp
**Tier Guidelines**: STRONG (40-50% tech), MODERATE (25-35%), WEAK (15-25%), AVOID (5-15%)
**Ticker Rules**: Quality mega-caps only (AAPL/MSFT/META/NVDA) + BTC/ETH with entry levels
**Status**: ✅ Integrated into wingman_dash.py Phase 5 (ready for Monday deployment)

---

**Last Updated**: October 24, 2025
**Status**: Production-ready - integrated into Wingman Dash workflow
**Requires**: Claude Code manual update (not fully automated)
